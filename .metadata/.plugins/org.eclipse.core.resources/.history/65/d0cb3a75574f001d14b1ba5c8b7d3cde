<!DOCTYPE html>
<html>

<head>
	<meta charset="EUC-KR">
	<title>지도 시작하기</title>
</head>

<body>
	<!-- 현재 지도 서비스 타임리프출력이 제대로 되나 확인용 -->
	<h1>지도서비스</h1>

	<!--
		지도서비스를 하려면 3가지가 필요 
		1. 지도를 표시할 영역  
		   예) <div id="map"> </div>
		2. 지도 OPEN API 서비스 선택 
		   예) 무료 300,000뷰 - 카카오
		       유료 국내지도 강점 - naver지도
		       유료 전세계 지도 서비스 1위 - 구글맵  
		3. 지도서비스를 어떻게 이용할 것인지 아이디어 
		   이쪽이 메인 주로 비즈니스 로직파트(=Controller로 불림) 
	-->

	<!-- 1. 지도를 표시할 영역 -->
	<div id="map" style="width: 100%; height: 780px;"></div>
	<!-- 2. 사용할 지도 OPEN API -->
	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4f85ad1c7928c6c94137ae247fe07b3a"></script>

	<!-- 3. 우리가 풀어야할 비즈니스 록직(=Controller) -->
	<!-- 
		1. 지도를 표시하고
		2. 현재 위치를 구하고
		3. 그위치에 마커와 정보창을 띄훈다.
		-->
	<script>
		// 카카오맵서비스를 이용 지도표시 하기
		// mapContainer : 지도를 표시할  HTML div태그를 가져온다.
		// mapOption : 카카오 지도를 표시할 기본옵션( 기본표시할 위도 경도, 화면줌배율)    	
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
			mapOption = {
				center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
				level: 2 // 지도의 확대 레벨 
			};

		// 기본옵션을 이둉한 실제 지도 그리기
		var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다


		// 현재위치 구하기 = HTML5의 geolocation API을 사용 
		// HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
		if (navigator.geolocation) {

			// GeoLocation을 이용해서 접속 위치를 얻어옵니다
			// getCurrentPosition() : 현재 위치 결과값을 비동기로 반환한다.  
			// getCurrentPosition(콜백함수(입력변수 :현재위치에 관련된 정보))
			navigator.geolocation.getCurrentPosition(function (position) {
				// 현재 위치를 얻었다 새로 지도를 그리자
				var lat = position.coords.latitude, // 위도
					lon = position.coords.longitude; // 경도

				// 새로운 위치의 지도를 그리자
				var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
					message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다

				// 마커와 인포윈도우를 표시합니다
				displayMarker(locPosition, message);

			});

		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

			var locPosition = new kakao.maps.LatLng(33.450701, 126.570667),
				message = 'geolocation을 사용할수 없어요..'

			displayMarker(locPosition, message);
		}

		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new kakao.maps.services.Geocoder();

		// 지도에 마커와 인포윈도우를 표시하는 함수입니다
		function displayMarker(locPosition, message) {

			// 마커를 생성합니다
			var marker = new kakao.maps.Marker({
				map: map,
				position: locPosition
			});

			var iwContent = message, // 인포윈도우에 표시할 내용
				iwRemoveable = true;

			// 인포윈도우를 생성합니다
			var infowindow = new kakao.maps.InfoWindow({
				content: iwContent,
				removable: iwRemoveable
			});

			// 인포윈도우를 마커위에 표시합니다 
			infowindow.open(map, marker);

			// 지도 중심좌표를 접속위치로 변경합니다
			map.setCenter(locPosition);
		}    
	</script>
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
			mapOption = {
				center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
				level: 1 // 지도의 확대 레벨
			};

		// 지도를 생성합니다    
		var map = new kakao.maps.Map(mapContainer, mapOption);

		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new kakao.maps.services.Geocoder();

		var marker = new kakao.maps.Marker(), // 클릭한 위치를 표시할 마커입니다
			infowindow = new kakao.maps.InfoWindow({zindex: 1}); // 클릭한 위치에 대한 주소를 표시할 인포윈도우입니다

		// 현재 지도 중심좌표로 주소를 검색해서 지도 좌측 상단에 표시합니다
		searchAddrFromCoords(map.getCenter(), displayCenterInfo);

		// 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
		kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
			searchDetailAddrFromCoords(mouseEvent.latLng, function (result, status) {
				if (status === kakao.maps.services.Status.OK) {
					var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
					detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';

					var content = '<div class="bAddr">' +
						'<span class="title">법정동 주소정보</span>' +
						detailAddr +
						'</div>';

					// 마커를 클릭한 위치에 표시합니다 
					marker.setPosition(mouseEvent.latLng);
					marker.setMap(map);

					// 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
					infowindow.setContent(content);
					infowindow.open(map, marker);
				}
			});
		});

		// 중심 좌표나 확대 수준이 변경됐을 때 지도 중심 좌표에 대한 주소 정보를 표시하도록 이벤트를 등록합니다
		kakao.maps.event.addListener(map, 'idle', function () {
			searchAddrFromCoords(map.getCenter(), displayCenterInfo);
		});

		function searchAddrFromCoords(coords, callback) {
			// 좌표로 행정동 주소 정보를 요청합니다
			geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);
		}

		function searchDetailAddrFromCoords(coords, callback) {
			// 좌표로 법정동 상세 주소 정보를 요청합니다
			geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
		}

		// 지도 좌측상단에 지도 중심좌표에 대한 주소정보를 표출하는 함수입니다
		function displayCenterInfo(result, status) {
			if (status === kakao.maps.services.Status.OK) {
				var infoDiv = document.getElementById('centerAddr');

				for (var i = 0; i < result.length; i++) {
					// 행정동의 region_type 값은 'H' 이므로
					if (result[i].region_type === 'H') {
						infoDiv.innerHTML = result[i].address_name;
						break;
					}
				}
			}
		}
	</script>



</body>

</html>